<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>yuDigital Indonesia - Katalog Masa Depan</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/page-flip/dist/js/page-flip.browser.js"></script>
    <style>
        :root {
            --hero-grad: linear-gradient(135deg, #7f00ff, #e100ff);
            --bg-stage: radial-gradient(circle at top right, #2a0845, #000000);
        }

        body {
            font-family: 'Poppins', sans-serif;
            margin: 0;
            background-color: #000;
            background-image: var(--bg-stage), radial-gradient(rgba(255, 255, 255, 0.08) 1px, transparent 1px);
            background-size: 100% 100%, 35px 35px;
            color: white;
            overflow: hidden;
            height: 100vh;
            touch-action: none;
        }

        #splash-screen {
            position: fixed; width: 100%; height: 100vh; background: white;
            display: flex; justify-content: center; align-items: center; z-index: 10000;
            transition: opacity 0.8s ease;
        }

        nav {
            padding: 15px 8%; display: flex; justify-content: space-between; align-items: center;
            background: rgba(0,0,0,0.6); backdrop-filter: blur(15px);
            position: fixed; top: 0; width: 84%; z-index: 1000;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .logo-text { font-size: 24px; font-weight: 800; background: var(--hero-grad); -webkit-background-clip: text; -webkit-text-fill-color: transparent; cursor: pointer; }

        #section-hero {
            height: 100vh; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center;
            background: var(--hero-grad); padding: 0 20px;
        }
        .hero-img {
            max-width: 450px; width: 70%; height: auto; margin: 15px 0;
            filter: drop-shadow(0 20px 30px rgba(0,0,0,0.3));
        }
        .cta-btn { padding: 15px 45px; background: white; color: #7f00ff; border-radius: 50px; font-weight: 800; cursor: pointer; border: none; font-size: 1rem; box-shadow: 0 10px 20px rgba(0,0,0,0.2); transition: 0.3s; }

        #main-app-container { display: none; height: 100vh; position: relative; padding-top: 80px; box-sizing: border-box; }
        .app-page { display: none; height: 100%; width: 100%; position: relative; overflow: hidden; }

        .jenjang-grid {
            display: grid; 
            grid-template-columns: repeat(2, 1fr);
            gap: 12px; padding: 10px 5%; max-width: 1000px; margin: 0 auto;
            height: calc(100vh - 180px); align-content: center;
        }
        .jenjang-card {
            height: 100%; min-height: 110px; max-height: 150px;
            border-radius: 18px; background-size: cover; background-position: center;
            position: relative; overflow: hidden; cursor: pointer; transition: all 0.3s ease;
        }
        .jenjang-card::after { content: ''; position: absolute; inset: 0; opacity: 0.85; z-index: 1; }
        .jenjang-info { position: absolute; bottom: 12px; left: 12px; z-index: 2; color: #1a1a1a; }
        .jenjang-info h3 { margin: 0; font-size: 1.1rem; font-weight: 800; }

        .wheel-page-container {
            height: calc(100% - 220px); perspective: 2000px; position: relative; overflow: hidden;
            display: flex; justify-content: center; align-items: center;
        }
        .wheel-container {
            position: absolute; width: 100%; max-width: 450px; height: 450px;
            transform-style: preserve-3d; cursor: grab; transition: transform 0.4s cubic-bezier(0.23, 1, 0.32, 1);
        }
        .book-list-card {
            position: absolute; width: 90%; height: 75px; left: 5%; top: 187px;
            background-size: cover; background-position: center; border-radius: 15px;
            display: flex; align-items: center; padding: 0 25px;
            backface-visibility: hidden; border: 1px solid rgba(255,255,255,0.1); box-sizing: border-box;
            cursor: pointer;
        }
        .book-list-card::after {
            content: ''; position: absolute; inset: 0;
            background: linear-gradient(90deg, rgba(0,0,0,0.85) 30%, rgba(0,0,0,0.1)); border-radius: 15px;
        }
        .book-content { position: relative; z-index: 2; margin-top: 6px; }
        .book-content h3 { margin: 0; font-size: 0.9rem; line-height: 1.2; }
        .book-content p { margin: 2px 0 0 0; font-size: 0.65rem; opacity: 0.7; }

        .selection-highlight {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 95%; max-width: 480px; height: 85px;
            border-top: 1px solid rgba(255,255,255,0.15); border-bottom: 1px solid rgba(255,255,255,0.15);
            background: rgba(255,255,255,0.03); pointer-events: none; z-index: 1;
        }

        .katalog-header { text-align: center; padding: 10px 0; z-index: 10; position: relative; }
        .search-container { margin: 10px auto; width: 85%; max-width: 350px; position: relative; z-index: 20; }
        .search-input {
            width: 100%; padding: 10px 18px; border-radius: 20px; border: 1px solid rgba(255,255,255,0.2);
            background: rgba(255,255,255,0.1); color: white; outline: none; font-family: 'Poppins', sans-serif;
            box-sizing: border-box;
        }
        .katalog-footer { position: absolute; bottom: 30px; width: 100%; text-align: center; z-index: 100; }
        .btn-back { padding: 10px 30px; border-radius: 30px; border: 1px solid rgba(255,255,255,0.2); background: rgba(255,255,255,0.1); color: white; cursor: pointer; }

        .modal-viewer {
            display: none; position: fixed; inset: 0; z-index: 5000;
            background: rgba(0,0,0,0.98); justify-content: center; align-items: center;
        }
        .close-btn { position: absolute; top: 20px; right: 25px; color: white; font-size: 45px; cursor: pointer; z-index: 6000; line-height: 1; }
        #book-viewport { width: 100%; height: 100%; display: flex; justify-content: center; align-items: center; }

        .page { background-color: white; box-shadow: inset 7px 0 30px -7px rgba(0,0,0,0.2); }
        .page-cover { box-shadow: none !important; }
    </style>
</head>
<body>

    <div id="splash-screen"><img src="Bumper-Yudigital.gif" width="140"></div>

    <nav><div class="logo-text" onclick="location.reload()">yuDigital</div></nav>

    <section id="section-hero">
        <h1 style="font-size: 2.8rem; margin: 0;">yuDigital</h1>
        <p style="opacity: 0.9; margin: 5px 0; font-size: 0.9rem;">Pusat Literasi Digital Terpadu</p>
        <img src="komp&Tablet.png" class="hero-img" alt="Device Preview">
        <button class="cta-btn" onclick="navigateTo('page-jenjang')">Masuk Katalog</button>
    </section>

    <main id="main-app-container">
        <section id="page-jenjang" class="app-page">
            <div class="page-title" style="text-align:center; padding-top:15px; font-size: 1rem;">Pilih Jenjang</div>
            <div class="jenjang-grid" id="jenjang-container"></div>
        </section>

        <section id="page-katalog" class="app-page">
            <div class="katalog-header">
                <div class="page-title" id="katalog-label">Katalog</div>
                <div class="search-container">
                    <input type="text" id="search-input" class="search-input" placeholder="Cari judul buku..." oninput="filterBuku()">
                </div>
            </div>
            <div class="wheel-page-container" id="swipe-area">
                <div class="selection-highlight"></div>
                <div id="wheel-buku" class="wheel-container"></div>
            </div>
            <div class="katalog-footer">
                <button class="btn-back" onclick="navigateTo('page-jenjang')">‚Üê KEMBALI</button>
            </div>
        </section>
    </main>

    <div id="modal-viewer" class="modal-viewer">
        <span class="close-btn" onclick="closeViewer()">&times;</span>
        <div id="book-viewport"><div id="flipbook-element"></div></div>
    </div>

    <script>
        const genPages = (n, prefix) => Array.from({ length: n }, (_, i) => `${prefix}${i + 1}.webp`);
        const dataBuku = [
            { jenjang: "SD", judul: "IPAS 3 SD Kls III", folder: "sd/IPAS", cover: "cover/cover1.png", pages: genPages(8, "IPAS 3 SD_Page_"), desc: "Kurikulum Merdeka" },
            { jenjang: "SD", judul: "IPAS 5 SD Kls V", folder: "sd/IPAS", cover: "cover/cover2.png", pages: genPages(8, "IPAS 3 SD_Page_"), desc: "Kurikulum Merdeka" },
            { jenjang: "SD", judul: "Bahasa Indonesia 1 SD Kls I", folder: "sd/Bhs", cover: "cover/cover3.png", pages: genPages(6, "Bhs-"), desc: "Literasi Dasar" },
            { jenjang: "SD", judul: "Bahasa Indonesia 2 SD Kls II", folder: "sd/Bhs", cover: "cover/cover4.png", pages: genPages(6, "Bhs-"), desc: "Literasi Dasar" },
            { jenjang: "SD", judul: "Basic English 1 SD Kls I", folder: "sd/IPAS", cover: "cover/cover5.png", pages: genPages(8, "IPAS 3 SD_Page_"), desc: "Kurikulum Merdeka" },
            { jenjang: "SD", judul: "Matematika 1 SD Kls I", folder: "sd/Bhs", cover: "cover/cover6.png", pages: genPages(6, "Bhs-"), desc: "Literasi Dasar" },
            { jenjang: "SD", judul: "Matematika 2 SD Kls II", folder: "sd/IPAS", cover: "cover/cover7.png", pages: genPages(8, "IPAS 3 SD_Page_"), desc: "Kurikulum Merdeka" },
            { jenjang: "SD", judul: "Matematika 3 SD Kls III", folder: "sd/Bhs", cover: "cover/cover8.png", pages: genPages(6, "Bhs-"), desc: "Literasi Dasar" },
            { jenjang: "SD", judul: "Pendidikan Pancasila 1 SD Kls I", folder: "sd/IPAS", cover: "cover/cover9.png", pages: genPages(8, "IPAS 3 SD_Page_"), desc: "Kurikulum Merdeka" },
            { jenjang: "SD", judul: "Pendidikan Pancasila 4 SD Kls IV", folder: "sd/Bhs", cover: "cover/cover10.png", pages: genPages(6, "Bhs-"), desc: "Literasi Dasar" },
            { jenjang: "SD", judul: "Pendidikan Pancasila 5 SD Kls V", folder: "sd/IPAS", cover: "cover/cover1.png", pages: genPages(8, "IPAS 3 SD_Page_"), desc: "Kurikulum Merdeka" },
            { jenjang: "SD", judul: "Pendidikan Pancasila 6 SD Kls VI", folder: "sd/Bhs", cover: "cover/cover2.png", pages: genPages(6, "Bhs-"), desc: "Literasi Dasar" },
            { jenjang: "SMP", judul: "IPA SMP", folder: "smp", cover: "cover/cover1.png", pages: genPages(7, "IPA "), desc: "Sains Menengah" },
            { jenjang: "SMP", judul: "IPA SMP", folder: "smp", cover: "cover/cover2.png", pages: genPages(7, "IPA "), desc: "Sains Menengah" },
            { jenjang: "SMP", judul: "IPA SMP", folder: "smp", cover: "cover/cover3.png", pages: genPages(7, "IPA "), desc: "Sains Menengah" },
            { jenjang: "SMP", judul: "IPA SMP", folder: "smp", cover: "cover/cover4.png", pages: genPages(7, "IPA "), desc: "Sains Menengah" },
            { jenjang: "SMP", judul: "IPA SMP", folder: "smp", cover: "cover/cover5.png", pages: genPages(7, "IPA "), desc: "Sains Menengah" },
            { jenjang: "SMP", judul: "IPA SMP", folder: "smp", cover: "cover/cover6.png", pages: genPages(7, "IPA "), desc: "Sains Menengah" },
            { jenjang: "SMP", judul: "IPA SMP", folder: "smp", cover: "cover/cover7.png", pages: genPages(7, "IPA "), desc: "Sains Menengah" },
            { jenjang: "SMA", judul: "Kimia SMA", folder: "sma", cover: "cover/cover1.png", pages: genPages(8, "Kimia 1 SMA_Page_"), desc: "Reaksi Kimia" },
            { jenjang: "SMA", judul: "Kimia SMA", folder: "sma", cover: "cover/cover2.png", pages: genPages(8, "Kimia 1 SMA_Page_"), desc: "Reaksi Kimia" },
            { jenjang: "SMA", judul: "Kimia SMA", folder: "sma", cover: "cover/cover3.png", pages: genPages(8, "Kimia 1 SMA_Page_"), desc: "Reaksi Kimia" },
            { jenjang: "SMA", judul: "Kimia SMA", folder: "sma", cover: "cover/cover4.png", pages: genPages(8, "Kimia 1 SMA_Page_"), desc: "Reaksi Kimia" },
            { jenjang: "SMA", judul: "Kimia SMA", folder: "sma", cover: "cover/cover5.png", pages: genPages(8, "Kimia 1 SMA_Page_"), desc: "Reaksi Kimia" },
            { jenjang: "SMA", judul: "Kimia SMA", folder: "sma", cover: "cover/cover6.png", pages: genPages(8, "Kimia 1 SMA_Page_"), desc: "Reaksi Kimia" },
            { jenjang: "SMA", judul: "Kimia SMA", folder: "sma", cover: "cover/cover7.png", pages: genPages(8, "Kimia 1 SMA_Page_"), desc: "Reaksi Kimia" },
            { jenjang: "SMK", judul: "Tehnik Permesinan", folder: "smk", cover: "cover/cover1.png", pages: genPages(8, "Kimia 1 SMA_Page_"), desc: "Reaksi Kimia" },
            { jenjang: "SMK", judul: "Tehnik Permesinan", folder: "smk", cover: "cover/cover2.png", pages: genPages(8, "Kimia 1 SMA_Page_"), desc: "Reaksi Kimia" },
            { jenjang: "SMK", judul: "Tehnik Permesinan", folder: "smk", cover: "cover/cover3.png", pages: genPages(8, "Kimia 1 SMA_Page_"), desc: "Reaksi Kimia" },
            { jenjang: "SMK", judul: "Tehnik Permesinan", folder: "smk", cover: "cover/cover4.png", pages: genPages(8, "Kimia 1 SMA_Page_"), desc: "Reaksi Kimia" },
            { jenjang: "SMK", judul: "Tehnik Permesinan", folder: "smk", cover: "cover/cover5.png", pages: genPages(8, "Kimia 1 SMA_Page_"), desc: "Reaksi Kimia" },
            { jenjang: "SMK", judul: "Tehnik Permesinan", folder: "smk", cover: "cover/cover6.png", pages: genPages(8, "Kimia 1 SMA_Page_"), desc: "Reaksi Kimia" },
            { jenjang: "SMK", judul: "Tehnik Permesinan", folder: "smk", cover: "cover/cover7.png", pages: genPages(8, "Kimia 1 SMA_Page_"), desc: "Reaksi Kimia" },
            { jenjang: "SMK", judul: "Tehnik Permesinan", folder: "smk", cover: "cover/cover8.png", pages: genPages(8, "Kimia 1 SMA_Page_"), desc: "Reaksi Kimia" },
            { jenjang: "Madrasah", judul: "MI Madrasah", folder: "madrasah", cover: "cover/cover1.png", pages: genPages(7, "mi-"), desc: "Katalog Religi" },
            { jenjang: "Madrasah", judul: "MI Madrasah", folder: "madrasah", cover: "cover/cover2.png", pages: genPages(7, "mi-"), desc: "Katalog Religi" },
            { jenjang: "Madrasah", judul: "MI Madrasah", folder: "madrasah", cover: "cover/cover3.png", pages: genPages(7, "mi-"), desc: "Katalog Religi" },
            { jenjang: "Madrasah", judul: "MI Madrasah", folder: "madrasah", cover: "cover/cover4.png", pages: genPages(7, "mi-"), desc: "Katalog Religi" },
            { jenjang: "Madrasah", judul: "MI Madrasah", folder: "madrasah", cover: "cover/cover5.png", pages: genPages(7, "mi-"), desc: "Katalog Religi" },
            { jenjang: "Madrasah", judul: "MI Madrasah", folder: "madrasah", cover: "cover/cover6.png", pages: genPages(7, "mi-"), desc: "Katalog Religi" },
            { jenjang: "Madrasah", judul: "MI Madrasah", folder: "madrasah", cover: "cover/cover7.png", pages: genPages(7, "mi-"), desc: "Katalog Religi" },
            { jenjang: "Madrasah", judul: "MI Madrasah", folder: "madrasah", cover: "cover/cover8.png", pages: genPages(7, "mi-"), desc: "Katalog Religi" },
            { jenjang: "Prime", judul: "Tehnik Permesinan", folder: "prime", cover: "cover/cover1.png", pages: genPages(8, "Kimia 1 SMA_Page_"), desc: "Reaksi Kimia" },
            { jenjang: "Prime", judul: "Tehnik Permesinan", folder: "prime", cover: "cover/cover2.png", pages: genPages(8, "Kimia 1 SMA_Page_"), desc: "Reaksi Kimia" },
            { jenjang: "Prime", judul: "Tehnik Permesinan", folder: "prime", cover: "cover/cover3.png", pages: genPages(8, "Kimia 1 SMA_Page_"), desc: "Reaksi Kimia" },
            { jenjang: "Prime", judul: "Tehnik Permesinan", folder: "prime", cover: "cover/cover4.png", pages: genPages(8, "Kimia 1 SMA_Page_"), desc: "Reaksi Kimia" },
            { jenjang: "Prime", judul: "Tehnik Permesinan", folder: "prime", cover: "cover/cover5.png", pages: genPages(8, "Kimia 1 SMA_Page_"), desc: "Reaksi Kimia" },
            { jenjang: "Prime", judul: "Tehnik Permesinan", folder: "prime", cover: "cover/cover6.png", pages: genPages(8, "Kimia 1 SMA_Page_"), desc: "Reaksi Kimia" },
            { jenjang: "Prime", judul: "Tehnik Permesinan", folder: "prime", cover: "cover/cover7.png", pages: genPages(8, "Kimia 1 SMA_Page_"), desc: "Reaksi Kimia" },
            { jenjang: "Prime", judul: "Tehnik Permesinan", folder: "prime", cover: "cover/cover8.png", pages: genPages(8, "Kimia 1 SMA_Page_"), desc: "Reaksi Kimia" },
            { jenjang: "Prime", judul: "Tehnik Permesinan", folder: "prime", cover: "cover/cover9.png", pages: genPages(8, "Kimia 1 SMA_Page_"), desc: "Reaksi Kimia" }
        ];

        let currentActivePage = 'hero';
        let currentRotation = 0;
        let activeJenjang = "";
        let filteredData = [];
        const radius = 160;
        let flipInstance = null;

        function navigateTo(id) {
            currentActivePage = id;
            document.getElementById('section-hero').style.display = (id === 'section-hero') ? 'flex' : 'none';
            document.getElementById('main-app-container').style.display = (id === 'section-hero') ? 'none' : 'block';
            document.querySelectorAll('.app-page').forEach(p => p.style.display = 'none');
            document.getElementById(id).style.display = 'block';
            if(id === 'page-jenjang') renderJenjangCards();
        }

        function renderJenjangCards() {
            const container = document.getElementById('jenjang-container');
            container.innerHTML = "";
            const jenjangs = [
                { name: "SD", img: "sd/coverSD.webp", color: "#E3F2FD" },
                { name: "SMP", img: "smp/coverSMP.webp", color: "#FCE4EC" },
                { name: "SMA", img: "sma/coverSMA.webp", color: "#E8F5E9" },
                { name: "SMK", img: "smk/coverSMK.webp", color: "#E8F5E9" },
                { name: "Madrasah", img: "madrasah/coverMadrasah.webp", color: "#FFF3E0" },
                { name: "Prime", img: "prime/coverSMA.webp", color: "#E8F5E9" }
            ];
            jenjangs.forEach(j => {
                const card = document.createElement('div');
                card.className = 'jenjang-card';
                card.style.backgroundImage = `url('${j.img}')`;
                card.innerHTML = `<style>.jenjang-card::after{background:${j.color}}</style><div class="jenjang-info"><h3>${j.name}</h3></div>`;
                card.onclick = () => { activeJenjang = j.name; showKatalogBuku(); };
                container.appendChild(card);
            });
        }

        function showKatalogBuku() {
            navigateTo('page-katalog');
            document.getElementById('search-input').value = "";
            document.getElementById('katalog-label').innerText = "KATALOG " + activeJenjang;
            filteredData = dataBuku.filter(b => b.jenjang === activeJenjang);
            currentRotation = 0;
            renderWheel();
        }

        function filterBuku() {
            const query = document.getElementById('search-input').value.toLowerCase();
            filteredData = dataBuku.filter(b => b.jenjang === activeJenjang && b.judul.toLowerCase().includes(query));
            currentRotation = 0;
            renderWheel();
        }

        function renderWheel() {
            const wheel = document.getElementById('wheel-buku');
            wheel.innerHTML = "";
            if(filteredData.length === 0) return;
            const theta = 360 / Math.max(filteredData.length, 10);
            filteredData.forEach((book, i) => {
                const card = document.createElement('div');
                card.className = 'book-list-card';
                card.style.backgroundImage = `url('${book.cover}')`;
                card.style.transform = `rotateX(${-i * theta}deg) translateZ(${radius}px)`;
                card.innerHTML = `<div class="book-content"><h3>${book.judul}</h3><p>${book.desc}</p></div>`;
                card.onclick = () => {
                    const activeIdx = Math.round(-currentRotation / theta);
                    const normalizedIdx = ((i % filteredData.length) + filteredData.length) % filteredData.length;
                    const normalizedActive = ((activeIdx % filteredData.length) + filteredData.length) % filteredData.length;
                    if (normalizedIdx === normalizedActive) openViewer(book);
                };
                wheel.appendChild(card);
            });
            updateWheelPosition();
        }

        function updateWheelPosition() {
            const wheel = document.getElementById('wheel-buku');
            if(!wheel) return;
            wheel.style.transform = `rotateX(${currentRotation}deg)`;
            const theta = 360 / Math.max(filteredData.length, 10);
            wheel.querySelectorAll('.book-list-card').forEach((card, i) => {
                const relRot = (currentRotation - (i * theta)) % 360;
                const isCenter = Math.abs(relRot) < 15 || Math.abs(relRot) > 345;
                card.style.opacity = isCenter ? "1" : "0.2";
                card.style.filter = isCenter ? "blur(0px)" : "blur(2px)";
                card.style.pointerEvents = isCenter ? "auto" : "none";
            });
        }

        let isMoving = false; let startPos = 0;
        const swipeArea = document.getElementById('swipe-area');

        const startAction = (e) => {
            if (document.getElementById('modal-viewer').style.display === 'flex') return;
            isMoving = true;
            startPos = e.pageY || e.touches[0].pageY;
            document.getElementById('wheel-buku').style.transition = 'none';
        };

        const moveAction = (e) => {
            if (!isMoving || filteredData.length === 0) return;
            const currentY = e.pageY || e.touches[0].pageY;
            const diff = startPos - currentY;
            currentRotation += diff * 0.4;
            updateWheelPosition();
            startPos = currentY;
            if(e.cancelable) e.preventDefault();
        };

        const endAction = () => {
            isMoving = false;
            const wheel = document.getElementById('wheel-buku');
            if(!wheel) return;
            wheel.style.transition = 'transform 0.4s cubic-bezier(0.23, 1, 0.32, 1)';
            const theta = 360 / Math.max(filteredData.length, 10);
            currentRotation = Math.round(currentRotation / theta) * theta;
            updateWheelPosition();
        };

        swipeArea.addEventListener('mousedown', startAction);
        window.addEventListener('mousemove', moveAction);
        window.addEventListener('mouseup', endAction);
        swipeArea.addEventListener('touchstart', startAction, {passive: false});
        swipeArea.addEventListener('touchmove', moveAction, {passive: false});
        swipeArea.addEventListener('touchend', endAction);

        window.addEventListener('keydown', (e) => {
            if (currentActivePage !== 'page-katalog' || filteredData.length === 0) return;
            if (document.getElementById('modal-viewer').style.display === 'flex') return;
            
            const theta = 360 / Math.max(filteredData.length, 10);
            const wheel = document.getElementById('wheel-buku');
            wheel.style.transition = 'transform 0.4s cubic-bezier(0.23, 1, 0.32, 1)';
            
            if (e.key === "ArrowUp") currentRotation -= theta;
            else if (e.key === "ArrowDown") currentRotation += theta;
            else if (e.key === "Enter") {
                const activeIdx = Math.round(-currentRotation / theta);
                const normalizedActive = ((activeIdx % filteredData.length) + filteredData.length) % filteredData.length;
                openViewer(filteredData[normalizedActive]);
            }
            updateWheelPosition();
        });

        function openViewer(buku) {
            const modal = document.getElementById('modal-viewer');
            if (modal.style.display === 'flex') return;

            const fbElem = document.getElementById('flipbook-element');
            fbElem.innerHTML = "";

            const addPage = (src, isCover = false) => {
                const div = document.createElement('div');
                div.className = isCover ? 'page page-cover' : 'page';
                div.innerHTML = src.includes('<div') ? src : `<img src="${src}" style="width:100%; height:100%; object-fit:contain" onerror="this.src='cover/no-image.png'">`;
                fbElem.appendChild(div);
            };

            addPage(buku.cover, true);
            buku.pages.forEach(p => addPage(`${buku.folder}/${p}`));
            addPage(`<div style="width:100%; height:100%; background:#111; display:flex; justify-content:center; align-items:center;"><p style="color:#555">yuDigital</p></div>`, true);

            modal.style.display = 'flex';
            setTimeout(() => {
                const w = window.innerWidth, h = window.innerHeight;
                let bW = w > 800 ? 500 : w * 0.9, bH = bW * 1.45;
                if (bH > h * 0.85) { bH = h * 0.85; bW = bH / 1.45; }
                
                if (flipInstance) flipInstance.destroy();
                flipInstance = new St.PageFlip(fbElem, { 
                    width: bW, height: bH, size: "fixed", 
                    usePortrait: true, showCover: true, mobileScrollSupport: false
                });
                flipInstance.loadFromHTML(document.querySelectorAll('.page'));
            }, 200);
        }

        function closeViewer() {
            const modal = document.getElementById('modal-viewer');
            modal.style.display = 'none';
            
            if (flipInstance) {
                try { flipInstance.destroy(); } catch (e) {}
                flipInstance = null;
            }
            
            // RESET TOTAL ELEMENT UNTUK MENGHAPUS SEMUA EVENT LISTENER BAWAAN LIBRARY
            const viewport = document.getElementById('book-viewport');
            viewport.innerHTML = '<div id="flipbook-element"></div>';
            
            // Kembalikan interaksi
            isMoving = false;
            window.focus(); 
            updateWheelPosition();
        }

        window.onload = () => {
            setTimeout(() => {
                const s = document.getElementById('splash-screen');
                s.style.opacity = '0';
                setTimeout(() => s.style.display = 'none', 800);
            }, 1000);
        };
    </script>
</body>
</html>